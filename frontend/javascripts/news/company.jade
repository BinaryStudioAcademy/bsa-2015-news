md-content#company
	.search
		md-input-container
			md-icon.fa.fa-search
			input(type='text', placeholder='Search' ng-model="newsCtrl.newsFilter")
		md-button.md-raised.md-primary(type='button' ng-click='newsCtrl.toggleForm()' ng-if='newsCtrl.checkRights(undefined)') New post

	form.news-message(name="newsForm" ng-if='!newsCtrl.formView' ng-submit="newsForm.$valid && newsCtrl.createNews('company')" novalidate)
		.form-group
			input.form-control(type='text' name='title' placeholder='Title' ng-model='newsCtrl.news.title' required)
			div(ng-class='{validation: !newsCtrl.news.body}')
				textarea(ui-tinymce='newsCtrl.tinymceOptions', ng-model="newsCtrl.news.body" required)
				md-chips(ng-model="newsCtrl.news.restrict_ids" md-require-match="true" md-transform-chip="newsCtrl.transformUserChip($chip)")
					md-autocomplete(md-search-text="userQuery" md-items="item in newsCtrl.userSearch(userQuery)" placeholder="Hide news from")
						span(md-highlight-text="userQuery") {{item.name}} {{item.surname}}
					md-chip-template
						span
							{{newsCtrl.getUserName($chip)}}
				md-chips(ng-model="newsCtrl.news.access_roles" md-require-match="true" md-transform-chip="newsCtrl.transformRoleChip($chip)")
					md-autocomplete(md-search-text="roleQuery" md-items="item in newsCtrl.roleSearch(roleQuery)" placeholder="Show news only for")
						span(md-highlight-text="roleQuery") {{item.role}}
					md-chip-template
						span
							{{$chip}}
		md-button.md-raised.md-primary(type='submit') Create
		md-button(type='reset' ng-click='newsCtrl.toggleForm()') Cancel
	.news
		.news-message(ng-repeat='news in newsCtrl.companyPosts | filter: newsCtrl.newsSearch track by $index ')
			.title
				span.title-text(ng-click="newsCtrl.showModalPost(news._id, true)") {{news.title}}
				span.title-ctrls.comments-count.hide-mobile(ng-if='newsCtrl.checkRights(news.author)')
					md-button.md-icon-button.fa.fa-pencil-square-o(aria-label='edit' ng-click='newsCtrl.setEditing(news)' ng-show='!(newsCtrl.editing._id === news._id)')
						md-tooltip Edit
					md-button.md-icon-button.fa.fa-trash-o(aria-label='delete' ng-click='newsCtrl.deleteNews(news._id)' ng-show='!(newsCtrl.editing._id === news._id)')
						md-tooltip Delete
					md-button.md-icon-button.fa.fa-undo(aria-label='cancel' ng-click='newsCtrl.restoreData("news")' ng-show='(newsCtrl.editing._id === news._id)')
						md-tooltip Cancel
					md-button.md-icon-button.fa.fa-floppy-o(aria-label='save' ng-click='newsCtrl.editpost(news)' ng-show='(newsCtrl.editing._id === news._id)')
						md-tooltip Save
			.body
				div(ng-if='!(newsCtrl.editing._id === news._id)', style='white-space: pre-wrap')
					div.inner-news(ng-bind-html='news.body | unsafe')
				div(ng-if='(newsCtrl.editing._id === news._id)')
					textarea(ng-model='news.body', ui-tinymce='newsCtrl.tinymceOptions')
					md-chips(ng-model="news.restrict_ids" md-require-match="true" md-transform-chip="newsCtrl.transformUserChip($chip)")
						md-autocomplete(md-search-text="userQuery" md-items="item in newsCtrl.userSearch(userQuery)" placeholder="Hide news from")
							span(md-highlight-text="userQuery") {{item.name}} {{item.surname}}
						md-chip-template
							span
								{{newsCtrl.getUserName($chip)}}
					md-chips(ng-model="news.access_roles" md-require-match="true" md-transform-chip="newsCtrl.transformRoleChip($chip)")
						md-autocomplete(md-search-text="roleQuery" md-items="item in newsCtrl.roleSearch(roleQuery)" placeholder="Show news only for")
							span(md-highlight-text="roleQuery") {{item.role}}
						md-chip-template
							span
								{{$chip}}
					br
					md-button.md-raised.md-primary(ng-click='newsCtrl.editpost(news)') Save
					md-button(ng-click='newsCtrl.restoreData("news")') Cancel
			.footer
				span.author {{newsCtrl.userIdConvert(news.author)}}
				span.hide-mobile on {{news.date | date:'yyyy-MMM-dd HH:mm'}}
				span.comments-count
					md-button.md-icon-button.fa.fa-commenting-o(aria-label='Coment' ng-click='newsCtrl.toggleCommentForm($index)')  {{news.comments.length}}
						md-tooltip Comment
					md-button.md-icon-button.fa.fa-thumbs-o-up(ng-click='newsCtrl.newsLike(news._id, newsCtrl.user, $index, "company")' ng-if='!newsCtrl.findLike(news.likes)')  {{news.likes.length}}
					md-button.md-icon-button.fa.fa-thumbs-up(ng-click='newsCtrl.newsLike(news._id, newsCtrl.user, $index, "company")' ng-if='newsCtrl.findLike(news.likes)')  {{news.likes.length}}
			.comments(ng-if='newsCtrl.commentForm[$index]')
				form#comment-form(name='newCommentForm' ng-submit="newCommentForm.$valid && newsCtrl.newComment(commentText, news._id, $index)" novalidate)
					div(ng-class='{validation: !newsCtrl.commentText}')
						textarea.form-control(ui-tinymce='newsCtrl.tinymceCommentOptions' ng-model="commentText" placeholder='Comment' required)
					md-button.md-raised.md-primary(type='submit') Add comment
					md-button(ng-click='newsCtrl.toggleCommentForm($index)') Cancel
			.comment-wrap
				.comment(ng-repeat='comment in news.comments | reverse')
					div(ng-if='!(newsCtrl.editing._id === comment._id)', style='white-space: pre-wrap')
						i.fa.fa-times.delete-post(ng-click='newsCtrl.deleteComment(news._id, comment._id)' ng-if='newsCtrl.checkRights(comment.author)')
						i.fa.fa-pencil.delete-post.edit-post(ng-click='newsCtrl.setEditing(comment, news._id)' ng-if='newsCtrl.checkRights(comment.author)')
						.body(ng-bind-html='comment.body| unsafe')
						span.author {{newsCtrl.userIdConvert(comment.author)}}
						span.hide-mobile on {{comment.date | date:'yyyy-MMM-dd HH:mm'}}
						span.right-thumb
							md-button.md-icon-button.fa.fa-thumbs-o-up(ng-click='newsCtrl.commentLike(news._id, comment._id)' ng-if='!newsCtrl.findLike(comment.likes)')  {{comment.likes.length}}
							md-button.md-icon-button.fa.fa-thumbs-up(ng-click='newsCtrl.commentLike(news._id, comment._id)' ng-if='newsCtrl.findLike(comment.likes)')  {{comment.likes.length}}

					div(ng-if='(newsCtrl.editing._id === comment._id)')
						textarea(ng-model='comment.body', ui-tinymce='newsCtrl.tinymceCommentOptions')
						br
						md-button.md-raised.md-primary(ng-click='newsCtrl.editComment(news._id, comment)') Save
						md-button(ng-click='newsCtrl.restoreData("comment")') Cancel

